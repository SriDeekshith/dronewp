<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Drone Mission Planner</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
/* -------------------- THEME VARIABLES -------------------- */
:root {
    --primary: #1abc9c;
    --primary-dark: #16a085;
    --secondary: #3498db;
    --secondary-dark: #217dbb;
    --warning: #f39c12;
    --warning-dark: #d68910;
    --danger: #e74c3c;
    --danger-dark: #c0392b;

    --dark-bg: #0f2027;
    --mid-bg: #203a43;
    --light-bg: #2c5364;

    --card-bg: rgba(255, 255, 255, 0.08);

    --text-light: #ffffff;
    --text-muted: #b0bec5;

    --border-radius: 16px;
    --box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    --transition: all 0.3s ease;
}

/* ---------------------- BASE STYLE ----------------------- */
*{margin:0;padding:0;box-sizing:border-box;}

body{
    font-family:'Segoe UI',sans-serif;
    background:linear-gradient(135deg,var(--dark-bg),var(--mid-bg),var(--light-bg));
    color:var(--text-light);
    min-height:100vh;
    padding:20px;
}

.container{
    max-width:1000px;
    margin:auto;
}

/* ---------------------- HEADER --------------------------- */
.header{text-align:center;margin-bottom:30px;padding:20px;}

.header h1{
    font-size:2.8rem;
    background:linear-gradient(to right,var(--primary),var(--secondary));
    -webkit-background-clip:text;
    color:transparent;
}

/* ---------------------- CARDS ---------------------------- */
.card{
    background:var(--card-bg);
    backdrop-filter:blur(15px);
    border-radius:var(--border-radius);
    padding:25px;
    margin-bottom:25px;
    box-shadow:var(--box-shadow);
}

/* ---------------------- INPUTS --------------------------- */
.waypoint-grid{
    display:grid;
    grid-template-columns:repeat(3,1fr);
    gap:20px;
}

.input-group label{
    margin-bottom:5px;
    font-size:0.9rem;
    color:var(--text-muted);
}

.input-wrapper{
    position:relative;
}

.input-wrapper i{
    position:absolute;
    left:15px;
    top:50%;
    transform:translateY(-50%);
}

input{
    width:100%;
    padding:15px 15px 15px 45px;
    border-radius:12px;
    background:rgba(0,0,0,0.25);
    border:2px solid rgba(255,255,255,0.1);
    color:white;
}
input:focus{
    border-color:var(--primary);
    outline:none;
}

/* ---------------------- BUTTONS -------------------------- */
.buttons-grid{
    display:grid;
    grid-template-columns:repeat(4,1fr);
    gap:20px;
    margin:30px 0;
}

.btn{
    padding:18px;
    border:none;
    border-radius:var(--border-radius);
    font-size:1.1rem;
    font-weight:600;
    cursor:pointer;
    display:flex;
    justify-content:center;
    align-items:center;
    gap:10px;
    color:white;
}

.btn-send{background:linear-gradient(135deg,var(--primary),var(--primary-dark));}
.btn-start{background:linear-gradient(135deg,var(--secondary),var(--secondary-dark));}
.btn-rtl{background:linear-gradient(135deg,var(--warning),var(--warning-dark));}
.btn-stop{background:linear-gradient(135deg,var(--danger),var(--danger-dark));}

/* Loader Animation */
.btn-loading{
    color:transparent !important;
    position:relative;
}
.btn-loading::after{
    content:'';
    width:20px;height:20px;
    border:3px solid rgba(255,255,255,0.5);
    border-top-color:white;
    border-radius:50%;
    animation:spin 1s linear infinite;
    position:absolute;
}

@keyframes spin{to{transform:rotate(360deg);}}

/* ---------------------- STATUS --------------------------- */
.status-box{
    background:rgba(0,0,0,0.25);
    padding:25px;
    border-radius:var(--border-radius);
    text-align:center;
    box-shadow:var(--box-shadow);
    border-left:5px solid var(--primary);
}

.status-label{
    font-size:0.9rem;
    color:var(--text-muted);
}

.status-value{
    font-size:1.8rem;
    margin-top:10px;
}

/* Pulse Animation for active statuses */
.status-updating{
    animation:pulse 1.5s infinite;
}
@keyframes pulse{
    0%{opacity:.6}50%{opacity:1}100%{opacity:.6}
}

/* ---------------------- RESPONSIVE ----------------------- */
@media(max-width:992px){
    .waypoint-grid{grid-template-columns:repeat(2,1fr);}
    .buttons-grid{grid-template-columns:repeat(2,1fr);}
}
@media(max-width:576px){
    .waypoint-grid{grid-template-columns:1fr;}
    .buttons-grid{grid-template-columns:1fr;}
    .header h1{font-size:2rem;}
}
</style>
</head>

<body>
<div class="container">

    <div class="header">
        <h1><i class="fas fa-drone"></i> Drone Mission Planner</h1>
        <p>Plan and execute autonomous drone missions with precision.</p>
    </div>

    <!-- ---------------- Waypoint 1 (Required) ---------------- -->
    <div class="card">
        <h3><i class="fas fa-map-marker-alt"></i> Waypoint 1 (Required)</h3>
        <div class="waypoint-grid">
            <div class="input-group">
                <label>Latitude</label>
                <div class="input-wrapper"><i class="fas fa-globe"></i>
                    <input id="lat1" type="number" step="any">
                </div>
            </div>
            <div class="input-group">
                <label>Longitude</label>
                <div class="input-wrapper"><i class="fas fa-globe"></i>
                    <input id="lon1" type="number" step="any">
                </div>
            </div>
            <div class="input-group">
                <label>Altitude</label>
                <div class="input-wrapper"><i class="fas fa-arrow-up"></i>
                    <input id="alt1" type="number" value="20">
                </div>
            </div>
        </div>
    </div>

    <!-- ---------------- Waypoint 2 ---------------- -->
    <div class="card">
        <h3><i class="fas fa-map-marker-alt"></i> Waypoint 2 (Optional)</h3>
        <div class="waypoint-grid">
            <div class="input-group">
                <label>Latitude</label>
                <div class="input-wrapper"><i class="fas fa-globe"></i>
                    <input id="lat2" type="number" step="any">
                </div>
            </div>
            <div class="input-group">
                <label>Longitude</label>
                <div class="input-wrapper"><i class="fas fa-globe"></i>
                    <input id="lon2" type="number" step="any">
                </div>
            </div>
            <div class="input-group">
                <label>Altitude</label>
                <div class="input-wrapper"><i class="fas fa-arrow-up"></i>
                    <input id="alt2" type="number" value="20">
                </div>
            </div>
        </div>
    </div>

    <!-- ---------------- Waypoint 3 ---------------- -->
    <div class="card">
        <h3><i class="fas fa-map-marker-alt"></i> Waypoint 3 (Optional)</h3>
        <div class="waypoint-grid">
            <div class="input-group">
                <label>Latitude</label>
                <div class="input-wrapper"><i class="fas fa-globe"></i>
                    <input id="lat3" type="number" step="any">
                </div>
            </div>
            <div class="input-group">
                <label>Longitude</label>
                <div class="input-wrapper"><i class="fas fa-globe"></i>
                    <input id="lon3" type="number" step="any">
                </div>
            </div>
            <div class="input-group">
                <label>Altitude</label>
                <div class="input-wrapper"><i class="fas fa-arrow-up"></i>
                    <input id="alt3" type="number" value="20">
                </div>
            </div>
        </div>
    </div>

    <!-- ---------------- Waypoint 4 ---------------- -->
    <div class="card">
        <h3><i class="fas fa-map-marker-alt"></i> Waypoint 4 (Optional)</h3>
        <div class="waypoint-grid">
            <div class="input-group">
                <label>Latitude</label>
                <div class="input-wrapper"><i class="fas fa-globe"></i>
                    <input id="lat4" type="number" step="any">
                </div>
            </div>
            <div class="input-group">
                <label>Longitude</label>
                <div class="input-wrapper"><i class="fas fa-globe"></i>
                    <input id="lon4" type="number" step="any">
                </div>
            </div>
            <div class="input-group">
                <label>Altitude</label>
                <div class="input-wrapper"><i class="fas fa-arrow-up"></i>
                    <input id="alt4" type="number" value="20">
                </div>
            </div>
        </div>
    </div>

    <!-- ---------------- Buttons ---------------- -->
    <div class="buttons-grid">
        <button class="btn btn-send" onclick="sendMission()"><i class="fas fa-paper-plane"></i> Send</button>
        <button class="btn btn-start" onclick="startMission()"><i class="fas fa-play"></i> Start</button>
        <button class="btn btn-rtl" onclick="rtlMission()"><i class="fas fa-home"></i> RTL</button>
        <button class="btn btn-stop" onclick="stopMission()"><i class="fas fa-stop"></i> Stop</button>
    </div>

    <!-- ---------------- Status ---------------- -->
    <div class="status-box">
        <div class="status-label">Mission Status</div>
        <div class="status-value" id="statusBox">
            <i class="fas fa-sync fa-spin"></i> Waiting...
        </div>
    </div>

</div>

<!-- ---------------- FIREBASE SCRIPT ---------------- -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import { getDatabase, ref, set, update, onValue }
    from "https://www.gstatic.com/firebasejs/12.8.0/firebase-database.js";

const firebaseConfig = {
    apiKey: "AIzaSyCbIyCZV2ppiAP6rDExKP86fQePcgYQc5I",
    authDomain: "drone-986f4.firebaseapp.com",
    databaseURL: "https://drone-986f4-default-rtdb.firebaseio.com",
    projectId: "drone-986f4",
    storageBucket: "drone-986f4.appspot.com",
    messagingSenderId: "810516681904",
    appId: "1:810516681904:web:4ff8eebdeec0b594f95775"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

/* ----------------------- OPTIONAL WAYPOINT HANDLER ----------------------- */
function safeVal(input) {
    return input.value.trim() === "" ? "" : parseFloat(input.value);
}

/* ----------------------- SEND MISSION ----------------------- */
window.sendMission = function () {

    const btn = document.querySelector('.btn-send');
    const originalHTML = btn.innerHTML;

    // --- VALIDATE WP1 REQUIRED ---
    if (
        lat1.value.trim() === "" ||
        lon1.value.trim() === "" ||
        alt1.value.trim() === "" ||
        isNaN(parseFloat(lat1.value)) ||
        isNaN(parseFloat(lon1.value)) ||
        isNaN(parseFloat(alt1.value))
    ) {
        showNotification("Please enter valid Latitude, Longitude and Altitude for Waypoint 1!", "danger");
        return;
    }

    btn.classList.add("btn-loading");

    const waypoints = {
        wp1: { lat: parseFloat(lat1.value), lon: parseFloat(lon1.value), alt: parseFloat(alt1.value) },
        wp2: { lat: safeVal(lat2), lon: safeVal(lon2), alt: safeVal(alt2) },
        wp3: { lat: safeVal(lat3), lon: safeVal(lon3), alt: safeVal(alt3) },
        wp4: { lat: safeVal(lat4), lon: safeVal(lon4), alt: safeVal(alt4) }
    };

    set(ref(db, "mission/waypoints"), waypoints)
        .then(() => {
            showNotification("Waypoints Uploaded Successfully!", "success");
            updateStatus("Waypoints Ready");
        })
        .catch(err => showNotification("Upload Failed: " + err.message, "danger"))
        .finally(() => {
            btn.classList.remove("btn-loading");
            btn.innerHTML = originalHTML;
        });
};

/* ----------------------- START ----------------------- */
window.startMission = function () {
    update(ref(db, "mission"), { start: true });
    showNotification("Mission Started!", "success");
    updateStatus("In Progress");
};

/* ----------------------- RTL ----------------------- */
window.rtlMission = function () {
    update(ref(db, "mission"), { rtl: true });
    showNotification("Return to Launch Activated!", "warning");
    updateStatus("Returning");
};

/* ----------------------- STOP ----------------------- */
window.stopMission = function () {
    update(ref(db, "mission"), { stop: true });
    showNotification("Mission Stopped!", "danger");
    updateStatus("Stopped");
};

/* ----------------------- LIVE STATUS LISTENER ----------------------- */
const statusRef = ref(db, "mission/status");
onValue(statusRef, (snapshot) => {
    if (snapshot.exists()) updateStatus(snapshot.val());
});

/* ----------------------- HELPER ----------------------- */
function updateStatus(text) {
    const box = document.getElementById("statusBox");
    box.innerHTML = `<i class="fas fa-satellite"></i> ${text}`;

    if (text.includes("Progress") || text.includes("Returning"))
        box.classList.add("status-updating");
    else
        box.classList.remove("status-updating");
}

function showNotification(message, type) {
    const alert = document.createElement("div");

    alert.style.cssText = `
        position:fixed;right:20px;top:20px;
        background:#333;padding:15px 20px;
        border-radius:10px;color:#fff;font-weight:bold;
        z-index:9999;box-shadow:0 5px 15px rgba(0,0,0,.3);
        transform:translateX(200%);transition:.3s;
    `;

    if (type === "success") alert.style.background = "linear-gradient(135deg,#1abc9c,#16a085)";
    if (type === "warning") alert.style.background = "linear-gradient(135deg,#f39c12,#d68910)";
    if (type === "danger") alert.style.background = "linear-gradient(135deg,#e74c3c,#c0392b)";

    alert.innerHTML = message;
    document.body.appendChild(alert);

    setTimeout(() => alert.style.transform = "translateX(0%)", 10);
    setTimeout(() => {
        alert.style.transform = "translateX(200%)";
        setTimeout(() => alert.remove(), 300);
    }, 2500);
}
</script>

</body>
</html>
